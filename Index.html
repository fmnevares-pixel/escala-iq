<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Diagn√≥stico Estrat√©gico Inteligente para PyMEs - Descubre por qu√© tu negocio no escala">
  <title>Escala IQ‚Ñ¢ - Diagn√≥stico Estrat√©gico Inteligente</title>
  
  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    
    * {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #EFF6FF 0%, #FFFFFF 100%);
    }
    
    .logo-container {
      max-width: 320px;
      margin: 0 auto;
    }
    
    @media print {
      .no-print {
        display: none !important;
      }
    }

    /* Estilos para el resumen de respuestas */
    .answers-summary {
      max-height: 400px;
      overflow-y: auto;
    }

    .answer-item {
      transition: all 0.2s ease;
    }

    .answer-item:hover {
      background-color: #F3F4F6;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const EscalaIQApp = () => {
      const [stage, setStage] = useState('welcome');
      const [currentQuestion, setCurrentQuestion] = useState(0);
      const [answers, setAnswers] = useState({});
      const [privacyAccepted, setPrivacyAccepted] = useState(false);
      const [marketingAccepted, setMarketingAccepted] = useState(false);
      const [emailSending, setEmailSending] = useState(false);
      const [emailSent, setEmailSent] = useState(false);
      const [showAnswersSummary, setShowAnswersSummary] = useState(false);
      const [userData, setUserData] = useState({
        name: '',
        company: '',
        industry: '',
        revenue: '',
        employees: '',
        email: '',
        phone: ''
      });

      // Initialize EmailJS
      useEffect(() => {
        if (typeof emailjs !== 'undefined') {
          emailjs.init('s5nppWZkj52lmF4');
          console.log('‚úÖ EmailJS inicializado correctamente');
        } else {
          console.error('‚ùå EmailJS no se carg√≥ correctamente');
        }
      }, []);

      const questions = [
        // ESTRATEGIA
        {
          id: 'q1',
          area: 'Estrategia',
          question: '¬øTu empresa cuenta con Misi√≥n, Visi√≥n y Valores documentados y conocidos por todo el equipo?',
          options: [
            { value: 0, label: 'No tenemos nada documentado' },
            { value: 25, label: 'Est√° en la mente del due√±o, pero no escrito' },
            { value: 50, label: 'Est√° escrito pero nadie lo conoce' },
            { value: 75, label: 'Documentado y algunos lo conocen' },
            { value: 100, label: 'Documentado, todos lo conocen y lo viven' }
          ]
        },
        {
          id: 'q2',
          area: 'Estrategia',
          question: '¬øTienes objetivos espec√≠ficos y medibles para los pr√≥ximos 12 meses?',
          options: [
            { value: 0, label: 'No tenemos objetivos claros' },
            { value: 25, label: 'Tenemos ideas vagas de lo que queremos' },
            { value: 50, label: 'Tenemos objetivos pero no son medibles' },
            { value: 75, label: 'Objetivos definidos pero no se revisan' },
            { value: 100, label: 'Objetivos SMART con seguimiento mensual' }
          ]
        },
        {
          id: 'q3',
          area: 'Estrategia',
          question: '¬øLos roles y responsabilidades est√°n claramente definidos en tu organizaci√≥n?',
          options: [
            { value: 0, label: 'Cada quien hace de todo' },
            { value: 25, label: 'Roles verbales, no documentados' },
            { value: 50, label: 'Algunos roles est√°n definidos' },
            { value: 75, label: 'Roles definidos pero se traslapan' },
            { value: 100, label: 'Organigrama claro con descripci√≥n de puestos' }
          ]
        },
        // FINANZAS
        {
          id: 'q4',
          area: 'Finanzas',
          question: '¬øConoces con exactitud el costo real de cada producto/servicio que vendes?',
          options: [
            { value: 0, label: 'No lo s√© con certeza' },
            { value: 25, label: 'Tengo una idea aproximada' },
            { value: 50, label: 'Conozco costos directos, no indirectos' },
            { value: 75, label: 'Tengo costos pero no los actualizo' },
            { value: 100, label: 'Costeo detallado y actualizado mensualmente' }
          ]
        },
        {
          id: 'q5',
          area: 'Finanzas',
          question: '¬øC√≥mo llevas el control de tu flujo de caja?',
          options: [
            { value: 0, label: 'Veo el saldo bancario cuando necesito' },
            { value: 25, label: 'Registro en cuaderno/Excel b√°sico' },
            { value: 50, label: 'Excel con hist√≥rico pero sin proyecci√≥n' },
            { value: 75, label: 'Sistema contable pero no lo reviso seguido' },
            { value: 100, label: 'Flujo proyectado a 90 d√≠as con an√°lisis semanal' }
          ]
        },
        {
          id: 'q6',
          area: 'Finanzas',
          question: '¬øTienes una estrategia fiscal para optimizar impuestos legalmente?',
          options: [
            { value: 0, label: 'Pago lo que mi contador dice sin preguntar' },
            { value: 25, label: 'S√© que hay deducciones pero no las uso' },
            { value: 50, label: 'Uso algunas deducciones b√°sicas' },
            { value: 75, label: 'Planeo con mi contador pero reactivamente' },
            { value: 100, label: 'Estrategia fiscal anual con optimizaci√≥n proactiva' }
          ]
        },
        // OPERACIONES
        {
          id: 'q7',
          area: 'Operaciones',
          question: '¬øQu√© porcentaje de tus procesos clave est√°n documentados?',
          options: [
            { value: 0, label: 'Nada est√° documentado (0%)' },
            { value: 25, label: 'Muy poco documentado (1-25%)' },
            { value: 50, label: 'Algunos procesos (26-50%)' },
            { value: 75, label: 'La mayor√≠a (51-75%)' },
            { value: 100, label: 'Todo documentado y actualizado (76-100%)' }
          ]
        },
        {
          id: 'q8',
          area: 'Operaciones',
          question: '¬øCon qu√© frecuencia ocurren errores o reprocesos en tu operaci√≥n?',
          options: [
            { value: 0, label: 'Constantemente (varias veces por semana)' },
            { value: 25, label: 'Frecuentemente (al menos 1 vez por semana)' },
            { value: 50, label: 'Ocasionalmente (1-2 veces al mes)' },
            { value: 75, label: 'Rara vez (menos de 1 vez al mes)' },
            { value: 100, label: 'Casi nunca (sistema de calidad implementado)' }
          ]
        },
        {
          id: 'q9',
          area: 'Operaciones',
          question: '¬øQu√© tan digitalizada est√° tu operaci√≥n?',
          options: [
            { value: 0, label: 'Todo en papel o WhatsApp' },
            { value: 25, label: 'Excel y archivos compartidos' },
            { value: 50, label: 'Algunas herramientas digitales b√°sicas' },
            { value: 75, label: 'Software especializado en 1-2 √°reas' },
            { value: 100, label: 'Sistema integrado (ERP/CRM)' }
          ]
        },
        // COMERCIAL
        {
          id: 'q10',
          area: 'Comercial',
          question: '¬øTienes claramente definida tu propuesta de valor vs. competencia?',
          options: [
            { value: 0, label: 'No s√© qu√© nos diferencia realmente' },
            { value: 25, label: 'Tengo una idea pero no est√° clara' },
            { value: 50, label: 'S√© qu√© nos diferencia pero no lo comunico bien' },
            { value: 75, label: 'Definida pero no todos la conocen' },
            { value: 100, label: 'Propuesta clara, documentada y todos la viven' }
          ]
        },
        {
          id: 'q11',
          area: 'Comercial',
          question: '¬øC√≥mo es tu proceso de ventas?',
          options: [
            { value: 0, label: 'Cada vendedor hace lo que quiere' },
            { value: 25, label: 'Hay un proceso pero no se sigue' },
            { value: 50, label: 'Proceso definido parcialmente' },
            { value: 75, label: 'Proceso claro pero sin m√©tricas' },
            { value: 100, label: 'Proceso documentado con KPIs y seguimiento' }
          ]
        },
        {
          id: 'q12',
          area: 'Comercial',
          question: '¬øConoces tu costo de adquisici√≥n por cliente (CAC)?',
          options: [
            { value: 0, label: 'No s√© qu√© es eso' },
            { value: 25, label: 'He o√≠do del t√©rmino pero no lo calculo' },
            { value: 50, label: 'Tengo una idea aproximada' },
            { value: 75, label: 'Lo calculo pero no lo uso para decidir' },
            { value: 100, label: 'Lo mido, comparo con LTV y optimizo' }
          ]
        },
        // TALENTO
        {
          id: 'q13',
          area: 'Talento',
          question: '¬øC√≥mo describes la rotaci√≥n de personal en tu empresa?',
          options: [
            { value: 0, label: 'Muy alta (m√°s del 50% anual)' },
            { value: 25, label: 'Alta (30-50% anual)' },
            { value: 50, label: 'Moderada (15-30% anual)' },
            { value: 75, label: 'Baja (5-15% anual)' },
            { value: 100, label: 'Muy baja (menos del 5% anual)' }
          ]
        },
        {
          id: 'q14',
          area: 'Talento',
          question: '¬øTienes un programa de capacitaci√≥n y desarrollo?',
          options: [
            { value: 0, label: 'No capacitamos al equipo' },
            { value: 25, label: 'Capacitaci√≥n espor√°dica sin plan' },
            { value: 50, label: 'Capacitaciones b√°sicas ocasionales' },
            { value: 75, label: 'Plan de capacitaci√≥n anual' },
            { value: 100, label: 'Programa estructurado con rutas de carrera' }
          ]
        },
        {
          id: 'q15',
          area: 'Talento',
          question: '¬øTu equipo conoce y est√° alineado con los objetivos de la empresa?',
          options: [
            { value: 0, label: 'No conocen los objetivos' },
            { value: 25, label: 'Solo gerencia los conoce' },
            { value: 50, label: 'Se comunicaron una vez' },
            { value: 75, label: 'Se revisan trimestralmente' },
            { value: 100, label: 'Todos los conocen y tienen objetivos individuales alineados' }
          ]
        }
      ];

      const industries = [
        'Manufactura',
        'Comercio al por menor',
        'Comercio al por mayor',
        'Servicios profesionales',
        'Tecnolog√≠a y software',
        'Alimentos y bebidas',
        'Construcci√≥n',
        'Salud y bienestar',
        'Educaci√≥n',
        'Turismo y hospitalidad',
        'Log√≠stica y transporte',
        'Instituciones Microfinancieras',
        'Cooperativas',
        'Otro'
      ];

      const calculateResults = () => {
        const areaScores = {
          'Estrategia': [],
          'Finanzas': [],
          'Operaciones': [],
          'Comercial': [],
          'Talento': []
        };

        questions.forEach(q => {
          if (answers[q.id] !== undefined) {
            areaScores[q.area].push(answers[q.id]);
          }
        });

        const areaAverages = {};
        Object.keys(areaScores).forEach(area => {
          const scores = areaScores[area];
          areaAverages[area] = scores.length > 0
            ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length)
            : 0;
        });

        const allScores = Object.values(areaAverages);
        const overallScore = Math.round(allScores.reduce((a, b) => a + b, 0) / allScores.length);

        return { areaAverages, overallScore };
      };

      const identifyLeaks = (areaAverages) => {
        const leaksDb = {
          'Estrategia': {
            title: 'üéØ Falta de Direcci√≥n Estrat√©gica Clara',
            description: 'Sin una estrategia definida, tu equipo trabaja sin rumbo. Cada quien interpreta "el √©xito" a su manera.',
            impact: 'Costo estimado: 20-30% de productividad perdida + decisiones desalineadas'
          },
          'Finanzas': {
            title: 'üí∞ Descontrol Financiero',
            description: 'No sabes exactamente cu√°nto ganas o pierdes en cada venta. Est√°s vendiendo sin saber si es rentable.',
            impact: 'Costo estimado: 15-25% del margen se pierde en ineficiencias no detectadas'
          },
          'Operaciones': {
            title: '‚öôÔ∏è Procesos Ineficientes o Inexistentes',
            description: 'Todo depende de "qui√©n lo haga". Sin procesos documentados, la calidad var√≠a y los errores se repiten.',
            impact: 'Costo estimado: 20-40% del tiempo se pierde en reprocesos y "apagar fuegos"'
          },
          'Comercial': {
            title: 'üìä Sistema de Ventas Improvisado',
            description: 'Las ventas dependen del "talento" individual. No hay un sistema replicable que garantice resultados.',
            impact: 'Costo estimado: 30-50% de oportunidades se pierden por falta de seguimiento'
          },
          'Talento': {
            title: 'üë• Rotaci√≥n y Desalineaci√≥n del Equipo',
            description: 'Tu gente no sabe hacia d√≥nde va la empresa. La rotaci√≥n es alta y cada salida cuesta tiempo y dinero.',
            impact: 'Costo estimado: 150-200% del salario anual por cada empleado que se va'
          }
        };

        const sortedAreas = Object.entries(areaAverages)
          .sort(([, a], [, b]) => a - b)
          .slice(0, 3)
          .map(([area]) => leaksDb[area]);

        return sortedAreas;
      };

      const getMaturityLevel = (score) => {
        if (score >= 80) return { level: 'üèÜ L√çDER DE MERCADO', color: 'text-green-700', bgColor: 'bg-green-100' };
        if (score >= 60) return { level: 'üìà EN CRECIMIENTO', color: 'text-blue-700', bgColor: 'bg-blue-100' };
        if (score >= 40) return { level: '‚ö†Ô∏è ESTANCADO', color: 'text-yellow-700', bgColor: 'bg-yellow-100' };
        return { level: 'üö® CR√çTICO', color: 'text-red-700', bgColor: 'bg-red-100' };
      };

      const sendEmails = async () => {
        setEmailSending(true);
        const { areaAverages, overallScore } = calculateResults();
        const leaks = identifyLeaks(areaAverages);
        const maturity = getMaturityLevel(overallScore);

        try {
          console.log('üì§ Iniciando env√≠o de emails...');
          
          // Email para el cliente
          const clientEmailParams = {
            to_email: userData.email,
            to_name: userData.name,
            company_name: userData.company,
            overall_score: overallScore,
            maturity_level: maturity.level,
            estrategia_score: areaAverages['Estrategia'],
            finanzas_score: areaAverages['Finanzas'],
            operaciones_score: areaAverages['Operaciones'],
            comercial_score: areaAverages['Comercial'],
            talento_score: areaAverages['Talento'],
            leak_1: leaks[0]?.title || '',
            leak_2: leaks[1]?.title || '',
            leak_3: leaks[2]?.title || '',
            reply_to: 'contacto@escalaestexito.com.mx'
          };

          console.log('üìß Enviando email al cliente...', userData.email);
          const clientResponse = await emailjs.send(
            'service_qcuekol',
            'template_client',
            clientEmailParams
          );
          console.log('‚úÖ Email al cliente enviado:', clientResponse);

          // Email para Escala (notificaci√≥n interna)
          const adminEmailParams = {
            to_email: 'contacto@escalaestexito.com.mx',
            client_name: userData.name,
            client_email: userData.email,
            client_phone: userData.phone,
            company_name: userData.company,
            industry: userData.industry,
            revenue: userData.revenue,
            employees: userData.employees,
            overall_score: overallScore,
            maturity_level: maturity.level,
            estrategia_score: areaAverages['Estrategia'],
            finanzas_score: areaAverages['Finanzas'],
            operaciones_score: areaAverages['Operaciones'],
            comercial_score: areaAverages['Comercial'],
            talento_score: areaAverages['Talento']
          };

          console.log('üìß Enviando notificaci√≥n a Escala...');
          const adminResponse = await emailjs.send(
            'service_qcuekol',
            'template_admin',
            adminEmailParams
          );
          console.log('‚úÖ Notificaci√≥n a Escala enviada:', adminResponse);

          setEmailSent(true);
          console.log('‚úÖ Todos los emails enviados correctamente');
        } catch (error) {
          console.error('‚ùå Error al enviar emails:', error);
          alert('Hubo un problema al enviar los emails. Por favor contacta a contacto@escalaestexito.com.mx');
        } finally {
          setEmailSending(false);
        }
      };

      const handleStartAssessment = () => {
        const requiredFields = ['name', 'company', 'industry', 'email'];
        const isValid = requiredFields.every(field => userData[field].trim() !== '');

        if (!isValid) {
          alert('Por favor completa todos los campos obligatorios');
          return;
        }

        if (!privacyAccepted) {
          alert('Debes aceptar el aviso de privacidad para continuar');
          return;
        }

        setStage('questions');
      };

      const handleAnswer = (value) => {
        setAnswers({ ...answers, [questions[currentQuestion].id]: value });
      };

      const handleNext = () => {
        if (currentQuestion < questions.length - 1) {
          setCurrentQuestion(currentQuestion + 1);
        } else {
          setStage('results');
          sendEmails();
        }
      };

      const handleJumpToQuestion = (index) => {
        setCurrentQuestion(index);
        setShowAnswersSummary(false);
      };

      // Welcome stage
      if (stage === 'welcome') {
        return (
          <div className="min-h-screen gradient-bg p-4">
            <div className="max-w-4xl mx-auto py-8">
              <div className="text-center mb-8">
                <div className="logo-container mb-6">
                  <img 
                    src="https://i.postimg.cc/7Y5H6jvw/Disen-o-sin-ti-tulo-1.png" 
                    alt="Escala Logo" 
                    className="w-full h-auto"
                  />
                </div>
                <h1 className="text-4xl md:text-5xl font-bold mb-4 text-blue-900">
                  Escala IQ‚Ñ¢
                </h1>
                <p className="text-xl md:text-2xl text-gray-600 mb-2">
                  Diagn√≥stico Estrat√©gico Inteligente
                </p>
                <p className="text-lg text-gray-500">
                  Descubre las fugas de capital que est√°n frenando tu negocio
                </p>
              </div>

              <div className="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 className="text-2xl font-bold mb-6 text-blue-900">
                  ¬øPor qu√© tu negocio no escala como deber√≠a?
                </h2>
                
                <div className="space-y-4 mb-8 text-gray-700">
                  <div className="flex items-start gap-3">
                    <div className="text-2xl">üí∏</div>
                    <div>
                      <strong>Fugas de Capital invisibles:</strong> El 78% de las PyMEs pierde entre el 20-40% de su potencial de crecimiento por problemas que no detectan.
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <div className="text-2xl">üéØ</div>
                    <div>
                      <strong>15 preguntas estrat√©gicas:</strong> En 8 minutos identificar√°s exactamente d√≥nde est√°n tus principales obst√°culos.
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <div className="text-2xl">üìä</div>
                    <div>
                      <strong>Reporte personalizado:</strong> Recibir√°s tu Escala IQ Score y las 3 acciones prioritarias para tu negocio.
                    </div>
                  </div>
                </div>

                <form className="space-y-4">
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        Nombre completo *
                      </label>
                      <input
                        type="text"
                        required
                        value={userData.name}
                        onChange={(e) => setUserData({ ...userData, name: e.target.value })}
                        className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none"
                        placeholder="Juan P√©rez"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        Empresa *
                      </label>
                      <input
                        type="text"
                        required
                        value={userData.company}
                        onChange={(e) => setUserData({ ...userData, company: e.target.value })}
                        className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none"
                        placeholder="Mi Empresa S.A."
                      />
                    </div>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        Industria *
                      </label>
                      <select
                        required
                        value={userData.industry}
                        onChange={(e) => setUserData({ ...userData, industry: e.target.value })}
                        className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none"
                      >
                        <option value="">Selecciona tu industria</option>
                        {industries.map(industry => (
                          <option key={industry} value={industry}>{industry}</option>
                        ))}
                      </select>
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        Ingresos anuales aproximados
                      </label>
                      <select
                        value={userData.revenue}
                        onChange={(e) => setUserData({ ...userData, revenue: e.target.value })}
                        className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none"
                      >
                        <option value="">Selecciona un rango</option>
                        <option value="Menos de $1M">Menos de $1M MXN</option>
                        <option value="$1M - $5M">$1M - $5M MXN</option>
                        <option value="$5M - $20M">$5M - $20M MXN</option>
                        <option value="$20M - $50M">$20M - $50M MXN</option>
                        <option value="M√°s de $50M">M√°s de $50M MXN</option>
                      </select>
                    </div>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        N√∫mero de empleados
                      </label>
                      <select
                        value={userData.employees}
                        onChange={(e) => setUserData({ ...userData, employees: e.target.value })}
                        className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none"
                      >
                        <option value="">Selecciona un rango</option>
                        <option value="1-5">1-5 empleados</option>
                        <option value="6-10">6-10 empleados</option>
                        <option value="11-25">11-25 empleados</option>
                        <option value="26-50">26-50 empleados</option>
                        <option value="51-100">51-100 empleados</option>
                        <option value="M√°s de 100">M√°s de 100 empleados</option>
                      </select>
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        Email *
                      </label>
                      <input
                        type="email"
                        required
                        value={userData.email}
                        onChange={(e) => setUserData({ ...userData, email: e.target.value })}
                        className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none"
                        placeholder="tu@email.com"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      WhatsApp (opcional)
                    </label>
                    <input
                      type="tel"
                      value={userData.phone}
                      onChange={(e) => setUserData({ ...userData, phone: e.target.value })}
                      className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none"
                      placeholder="+52 55 1234 5678"
                    />
                  </div>

                  <div className="space-y-3 pt-4 border-t">
                    <label className="flex items-start gap-3 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyAccepted}
                        onChange={(e) => setPrivacyAccepted(e.target.checked)}
                        className="mt-1"
                      />
                      <span className="text-sm text-gray-600">
                        Acepto el <a href="#" className="text-blue-900 underline">aviso de privacidad</a> y autorizo el uso de mis datos para recibir mi diagn√≥stico. *
                      </span>
                    </label>

                    <label className="flex items-start gap-3 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={marketingAccepted}
                        onChange={(e) => setMarketingAccepted(e.target.checked)}
                        className="mt-1"
                      />
                      <span className="text-sm text-gray-600">
                        Deseo recibir contenido de valor y actualizaciones de Escala (opcional)
                      </span>
                    </label>
                  </div>

                  <button
                    type="button"
                    onClick={handleStartAssessment}
                    className="w-full bg-blue-900 text-white py-4 rounded-lg font-bold text-lg hover:bg-blue-800 transition-all"
                  >
                    Iniciar Diagn√≥stico (8 minutos) ‚Üí
                  </button>
                </form>
              </div>

              <div className="text-center text-gray-600 text-sm">
                <p>üîí Tus datos est√°n protegidos y solo se usar√°n para enviarte tu diagn√≥stico</p>
              </div>
            </div>
          </div>
        );
      }

      // Questions stage
      if (stage === 'questions') {
        const progress = ((currentQuestion + 1) / questions.length) * 100;
        const currentQ = questions[currentQuestion];
        const isAnswered = answers[currentQ.id] !== undefined;
        const answeredCount = Object.keys(answers).length;

        return (
          <div className="min-h-screen gradient-bg p-4">
            <div className="max-w-4xl mx-auto py-8">
              {/* Header con progreso */}
              <div className="mb-8">
                <div className="flex justify-between items-center mb-2">
                  <span className="text-sm font-semibold text-gray-600">
                    Pregunta {currentQuestion + 1} de {questions.length}
                  </span>
                  <span className="text-sm font-semibold text-blue-900">
                    {answeredCount}/{questions.length} completadas
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-3">
                  <div
                    className="bg-blue-900 h-3 rounded-full transition-all duration-300"
                    style={{ width: `${progress}%` }}
                  />
                </div>
              </div>

              {/* Bot√≥n para ver/editar respuestas anteriores */}
              {answeredCount > 0 && (
                <div className="mb-6">
                  <button
                    onClick={() => setShowAnswersSummary(!showAnswersSummary)}
                    className="flex items-center gap-2 px-4 py-2 bg-white rounded-lg shadow hover:shadow-md transition-all text-blue-900 font-semibold"
                  >
                    <span>üìã</span>
                    <span>{showAnswersSummary ? 'Ocultar' : 'Ver/Editar'} respuestas anteriores</span>
                  </button>
                </div>
              )}

              {/* Resumen de respuestas (expandible) */}
              {showAnswersSummary && (
                <div className="bg-white rounded-xl shadow-lg p-6 mb-6 answers-summary">
                  <h3 className="font-bold text-lg mb-4 text-blue-900">Tus respuestas hasta ahora:</h3>
                  <div className="space-y-2">
                    {questions.map((q, idx) => {
                      const answer = answers[q.id];
                      if (answer === undefined) return null;
                      
                      const selectedOption = q.options.find(opt => opt.value === answer);
                      
                      return (
                        <div
                          key={q.id}
                          onClick={() => handleJumpToQuestion(idx)}
                          className="answer-item p-3 border rounded-lg cursor-pointer flex justify-between items-start"
                        >
                          <div className="flex-1">
                            <div className="text-sm font-semibold text-gray-700 mb-1">
                              {idx + 1}. {q.question}
                            </div>
                            <div className="text-sm text-blue-900">
                              ‚úì {selectedOption?.label}
                            </div>
                          </div>
                          <button className="text-blue-900 hover:text-blue-700 font-semibold text-sm">
                            Editar ‚Üí
                          </button>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}

              {/* Pregunta actual */}
              <div className="bg-white rounded-xl shadow-lg p-8">
                <div className="mb-6">
                  <div className="inline-block px-4 py-2 bg-blue-100 text-blue-900 rounded-full text-sm font-bold mb-4">
                    {currentQ.area}
                  </div>
                  <h2 className="text-2xl font-bold text-gray-800 mb-6">
                    {currentQ.question}
                  </h2>

                  <div className="space-y-3">
                    {currentQ.options.map((option) => (
                      <button
                        key={option.value}
                        onClick={() => handleAnswer(option.value)}
                        className={`w-full p-4 text-left rounded-lg border-2 transition-all ${
                          answers[currentQ.id] === option.value
                            ? 'border-blue-900 bg-blue-50'
                            : 'border-gray-200 hover:border-blue-300'
                        }`}
                      >
                        <span className="font-medium text-gray-700">{option.label}</span>
                      </button>
                    ))}
                  </div>
                </div>

                <div className="flex justify-between mt-6">
                  <button
                    onClick={() => {
                      setShowAnswersSummary(false);
                      setCurrentQuestion(currentQuestion - 1);
                    }}
                    disabled={currentQuestion === 0}
                    className="px-6 py-3 text-gray-600 font-semibold rounded-lg border-2 border-gray-300 disabled:opacity-50 hover:bg-gray-50 transition-all"
                  >
                    ‚Üê Anterior
                  </button>

                  <button
                    onClick={() => {
                      setShowAnswersSummary(false);
                      handleNext();
                    }}
                    disabled={!isAnswered}
                    className="px-8 py-3 bg-blue-900 text-white font-bold rounded-lg disabled:opacity-50 hover:bg-blue-800 transition-all"
                  >
                    {currentQuestion === questions.length - 1 ? 'Ver Resultados' : 'Siguiente'} ‚Üí
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Results stage
      if (stage === 'results') {
        const { areaAverages, overallScore } = calculateResults();
        const leaks = identifyLeaks(areaAverages);
        const maturity = getMaturityLevel(overallScore);

        return (
          <div className="min-h-screen gradient-bg p-4">
            <div className="max-w-5xl mx-auto py-8">
              <div className="text-center mb-8">
                <div className="logo-container mb-4">
                  <img 
                    src="https://i.postimg.cc/7Y5H6jvw/Disen-o-sin-ti-tulo-1.png" 
                    alt="Escala Logo" 
                    className="w-full h-auto"
                  />
                </div>
                <h1 className="text-3xl font-bold mb-2 text-blue-900">
                  Tu Diagn√≥stico Escala IQ‚Ñ¢
                </h1>
                <p className="text-xl text-gray-600">
                  {userData.company} - {userData.name}
                </p>
              </div>

              <div className="bg-white rounded-xl shadow-lg p-8 mb-8 text-center">
                <div className="mb-4">
                  <div className={`inline-block px-6 py-2 rounded-full text-lg font-bold ${maturity.bgColor} ${maturity.color}`}>
                    {maturity.level}
                  </div>
                </div>
                <div className="text-7xl font-bold mb-2 text-blue-900">
                  {overallScore}
                </div>
                <p className="text-xl text-gray-600">Escala IQ Score</p>
                <p className="text-gray-500 mt-2">De 100 puntos posibles</p>
              </div>

              <div className="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 className="text-2xl font-bold mb-6 text-blue-900">
                  An√°lisis por √Årea
                </h2>
                <div className="space-y-4">
                  {Object.entries(areaAverages).map(([area, score]) => (
                    <div key={area}>
                      <div className="flex justify-between items-center mb-2">
                        <span className="font-semibold text-gray-700">{area}</span>
                        <span className="font-bold" style={{ color: score < 60 ? '#DC2626' : score < 75 ? '#F59E0B' : '#1B3A6D' }}>
                          {score}/100
                        </span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-3">
                        <div
                          className="h-3 rounded-full transition-all"
                          style={{
                            width: `${score}%`,
                            backgroundColor: score < 60 ? '#DC2626' : score < 75 ? '#F59E0B' : '#1B3A6D'
                          }}
                        />
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <div className="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 className="text-2xl font-bold mb-2 text-blue-900">
                  üö® Tus 3 Principales Fugas de Capital
                </h2>
                <p className="text-gray-600 mb-6">
                  Estos son los problemas cr√≠ticos que est√°n frenando tu crecimiento
                </p>
                
                <div className="space-y-4">
                  {leaks.map((leak, idx) => (
                    <div key={idx} className="border-l-4 border-red-500 bg-red-50 p-4 rounded-r-lg">
                      <h3 className="font-bold text-lg text-gray-800 mb-1">{leak.title}</h3>
                      <p className="text-gray-700 mb-2">{leak.description}</p>
                      <p className="text-sm font-semibold text-red-700">üí∏ {leak.impact}</p>
                    </div>
                  ))}
                </div>
              </div>

              <div className="bg-gradient-to-r from-red-500 to-orange-500 rounded-xl shadow-lg p-8 text-white text-center">
                <h2 className="text-3xl font-bold mb-4">
                  üéØ Da el Siguiente Paso
                </h2>
                <p className="text-xl mb-6">
                  Agenda tu <strong>Sesi√≥n Estrat√©gica de 45 minutos</strong> sin costo
                </p>
                <p className="mb-6 text-lg">
                  En esta sesi√≥n profundizaremos en tu diagn√≥stico y dise√±aremos un plan de acci√≥n espec√≠fico para {userData.company}
                </p>
                
                <button
                  onClick={() => window.location.href = 'https://www.escalaestexito.com.mx'}
                  className="bg-white text-blue-900 px-8 py-4 rounded-lg font-bold text-lg hover:bg-gray-100 transition-all"
                >
                  Agendar Sesi√≥n Estrat√©gica Gratuita ‚Üí
                </button>

                <p className="text-sm mt-4 opacity-90">
                  {emailSending && '‚è≥ Enviando tu reporte...'}
                  {emailSent && !emailSending && '‚úÖ Reporte enviado a ' + userData.email}
                  {!emailSending && !emailSent && 'üìß Recibir√°s tu reporte en ' + userData.email}
                </p>
              </div>

              <div className="bg-white rounded-lg shadow p-6 mt-8">
                <div className="flex flex-wrap justify-center gap-6 text-gray-700">
                  <div className="flex items-center gap-2">
                    <span>üì±</span>
                    <a href="https://wa.me/5255982678884" target="_blank" rel="noopener noreferrer" className="hover:underline">
                      +52 55 98 26 7884 (WhatsApp)
                    </a>
                  </div>
                  <div className="flex items-center gap-2">
                    <span>üìß</span>
                    <a href="mailto:contacto@escalaestexito.com.mx" className="hover:underline">contacto@escalaestexito.com.mx</a>
                  </div>
                </div>
              </div>

              <div className="text-center mt-8 text-gray-600">
                <p className="font-semibold mb-2">Escala, Estrategias para el √âxito S.A.S. de C.V.</p>
                <p className="text-sm">Metodolog√≠a avalada ante SEP-CONOCER</p>
                <p className="text-sm">+$1,600 millones movilizados en trayectoria</p>
                <p className="text-sm mt-4">
                  <a href="https://www.escalaestexito.com.mx" target="_blank" rel="noopener noreferrer" className="hover:underline text-blue-900">
                    www.escalaestexito.com.mx
                  </a>
                </p>
              </div>
            </div>
          </div>
        );
      }

      return null;
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<EscalaIQApp />);
  </script>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script>
    // Initialize Lucide icons
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    });
  </script>
</body>
</html>
